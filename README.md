# Отчет по лабораторной работе №5 по курсу "Объектно-ориентированное программирование"

---

Студент: Волков Алексей Александрович

Учебная группа: M8О-201БВ-24

Контакты: volckovl3sch@yandex.ru

Работа выполнена: 14.11.25

Преподаватель: Дзюба Дмитрий Владимирович

---

## Тема
Итераторы и аллокаторы
---

## Цель работы
1. Изучение устройства коллекций в стандартной библиотеке
2. Получение навыков в использовании концепции «итератор»
3. Получение навыков в использовании концепции «аллокатор»
4. Освоение работы с полиморфными аллокаторами (polymorphic_allocator)
5. Изучение стратегий управления памятью через пользовательские memory_resource

---

## Задание 
### Вариант 11 - Динамический массив со стратегией memory resource 5

#### Требования к программе:
- Реализовать наследник `std::pmr::memory_resource` с динамическим выделением памяти и хранением информации о блоках в `std::vector`
- Аллокатор должен переиспользовать освобожденную память
- Реализовать шаблонный контейнер `DynArray`, использующий созданный memory_resource через `std::pmr::polymorphic_allocator`
- Реализовать итератор, соответствующий `std::forward_iterator_tag`
- Создать код, демонстрирующий работу контейнера с простыми (int) и сложными типами (struct)

#### Реализованные классы:
1. `VectorMemoryResource` - стратегия управления памятью с отслеживанием в vector
2. `DynArray<T>` - шаблонный динамический массив с полиморфным аллокатором
3. `DynArrayIterator<T>` - итератор для прямого прохода по элементам

---
## Структура проекта
```txt
oop_lab5/
├── include/
│   ├── dyn_array.hpp            # Шаблонный класс DynArray<T>
│   ├── iterator.hpp             # Итератор DynArrayIterator<T>
│   └── memory_resource.hpp      # Класс VectorMemoryResource
├── src/
│   ├── memory_resource.cpp      # Реализация методов VectorMemoryResource
│   └── main_demo.cpp            # Демонстрационная программа
├── tests/
│   ├── main_test.cpp            # Запуск тестов
│   ├── dyn_array_test.cpp       # Тесты класса DynArray<T>
│   ├── iterator_test.cpp        # Тесты итераторов
│   └── memory_resource_test.cpp # Тесты аллокатора
└── CMakeLists.txt               # Система сборки
```

## Cборка и запуск

### Требования
    - Компилятор C++ с поддержкой стандарта C++20
    - CMake версии 3.14 или выше
    - Google Test для тестирования

### Инструкция по сборке:
```bash
# Сборка
mkdir build
cd build
cmake ..
make

# Запуск демонстрационной программы
./lab5_allocators

# Запуск тестов
./tests
```
---
## Особенности реализации

#### Полиморфный аллокатор и memory_resource
- **VectorMemoryResource** наследует от `std::pmr::memory_resource`
- **Стратегия 5**: динамическое выделение памяти с отслеживанием в `std::vector`
- **Переиспользование памяти**: освобожденные блоки доступны для новых аллокаций
- **Автоматическая очистка**: в деструкторе освобождается вся выделенная память
- **Статистика**: методы для отслеживания использования памяти

#### Шаблонный контейнер DynArray
- Использование `std::pmr::polymorphic_allocator<T>` для управления памятью
- **Автоматическое расширение**: при переполнении `capacity` увеличивается в 2 раза
- **Безопасное управление памятью**: использование `std::unique_ptr` с *default deleter*
- **Ручное управление деструкторами**: через `std::allocator_traits`
- **Поддержка копирования**: конструктор копирования и оператор присваивания

#### Итераторы
- `DynArrayIterator<T>` соответствует `std::forward_iterator_tag`
- Поддержка префиксного и постфиксного инкремента
- Совместимость с *range-based for loops*
- Константные и неконстантные версии итераторов

#### Управление памятью
- **Правильное использование construct/destroy**: через `std::allocator_traits`
- **Эффективная реаллокация**: с переносом элементов через `std::move_if_noexcept`
- **Отслеживание блоков**: `VectorMemoryResource` хранит информацию о всех выделенных блоках
- **Переиспользование**: свободные блоки доступны для новых запросов подходящего размера

#### Тестирование
- **13 unit-тестов** покрывающих все компоненты системы
- Проверка работы итераторов и *range-based for*
- Демонстрация переиспользования памяти
- Тестирование с простыми (*int*) и сложными пользовательскими типами

---
## Выводы
В ходе лабораторной работы были успешно освоены концепции итераторов и аллокаторов в C++:
1. **Реализован пользовательский memory_resource** с динамической стратегией управления памятью, демонстрирующий переиспользование освобожденных блоков
2. **Создан шаблонный контейнер `DynArray`**, использующий полиморфный аллокатор для гибкого управления памятью
3. **Разработан итератор**, соответствующий стандарту forward iterator, обеспечивающий совместимость с алгоритмами *STL* и *range-based for*
4. **Освоена работа с полиморфными аллокаторами**, позволяющими динамически менять стратегии управления памятью без изменения кода контейнера
5. **Продемонстрирована эффективность** автоматического управления памятью через умные указатели и правильное использование аллокаторных *traits*

Работа показала важность правильного управления памятью в C++ и преимущества полиморфных аллокаторов для создания гибких и эффективных контейнеров.